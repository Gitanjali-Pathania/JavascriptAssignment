<html>
  <head>
    <title>Simon Game</title>
     <link rel="stylesheet" href="./css/styles.css">
     <script type="text/javascript" src="./jsFiles/d3.min.js "></script>
     <audio id="type_0" src="https://s3.amazonaws.com/freecodecamp/simonSound1.mp3"></audio>
     <audio id="type_1" src="https://s3.amazonaws.com/freecodecamp/simonSound2.mp3"></audio>
     <audio id="type_2" src="https://s3.amazonaws.com/freecodecamp/simonSound3.mp3"></audio>
     <audio id="type_3" src="https://s3.amazonaws.com/freecodecamp/simonSound4.mp3"></audio>
  </head>

  <body>
    <div class="mainContainer1"></div>

    <script type="text/javascript">
    var dataset = {
  apples: [10, 10, 10,10]
};
var currentButton,noClickStatus=false;
var width = 400,
    height = 400,
    radius = Math.min(width, height) / 2;


var generatedSeq =[],userInputSequence=[],machinePlaySequence=[],generatedSeqFormat=[];

var color = d3.scale.category20();

var pie = d3.layout.pie()
    .sort(null);

var arc = d3.svg.arc()
    .innerRadius(radius - 150)
    .outerRadius(radius - 50);

var svg = d3.select(".mainContainer1").append("svg")
    .attr("width", width)
    .attr("height", height)
    .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

var path = svg.selectAll("path")
    .data(pie(dataset.apples))
  .enter().append("path")
    .attr("fill", function(d, i) { return color(i); })
    .attr("d", arc)
    .style("stroke-width",5)
    .style("stroke","grey")
    .attr("id",function(d,i){ return "type_"+i; })
    .on('click',function(d){
                  noClickStatus=false;
                  d3.select(this)
                          .style("stroke-width",10)
                          .transition()
                          .duration(500)
                          .style("stroke-width",5);
                  document.getElementById(d3.select(this).attr("id")).play();
                  userInputSequence.push(d3.select(this).attr("id"))
                  console.log(generatedSeqFormat)
                  console.log(userInputSequence)
                  if(userInputSequence.length===generatedSeqFormat.length)
                  {
                      console.log(arraysEqual(userInputSequence,generatedSeqFormat))

                      if(arraysEqual(userInputSequence,generatedSeqFormat))
                      {
                        setTimeout(function(){
                          play()
                        },3000)
                      }
                      else
                      {
                        playHint();  
                      }
                  }
                  else
                  {
                    // setTimeout(function(){
                    //                         if(noClickStatus)
                    //                               {playHint()}
                    //             },3000)
                  }
     });



  // setInterval(function(){
  //   noClickStatus=true
  // },2000)
    
function playHint(){
  console.log("playhint called")
  userInputSequence=[];
                        //generatedSeqFormat=[];
                        setTimeout(function(){
                        document.getElementById("type_0").play();
                         },2000)
                        setTimeout(function(){
                         generatedSeqFormat=[];
                         generatedSeq.forEach(function(d){
                                                            generatedSeqFormat.push("type_"+(d-1));
                                                        })
                         animateSound(generatedSeq);
                        },3000)
}

    // setInterval(function(){
    //   play()
    // },5000)

play()

function play(){
   console.log("play called")
  //generatedSeqFormat=[];
      //gameCounter++;
      generatedSeq.push(rand());
      generatedSeq.forEach(function(d){
          generatedSeqFormat.push("type_"+(d-1));
      })
      //console.log(generatedSeq)
      //machinePlaySequence.push("type_"+(_-1));
      animateSound(generatedSeq);
}


  function animateSound(){

    console.log(generatedSeq)

      generatedSeq.forEach(function(d,i){
        //console.log(d)
        setTimeout((function(_){
 //console.log(_);
          return function(){

              d3.selectAll("path")
                .each(function(d_){

                    var class_ = d3.select(this).attr("id");
                   
                    if("type_"+(_-1) === class_){
                      
                      //console.log("type_"+(_-1));
                      d3.select(this)
                          .style("stroke-width",10)
                          .transition()
                          .duration(500)
                          .style("stroke-width",5);
                      
                      document.getElementById("type_"+(_-1)).play();
                     // currentButton="type_"+_;
                     //console.log(machinePlaySequence);
                    }else{
                      d3.select(this).style("stroke","grey");
                    }

                })
            }
          //makesound
          //and Make the animation
        })(d),i*1000)
      })
}

   function arraysEqual(arr1, arr2) {
    if(arr1.length !== arr2.length)
        return false;
    for(var i = arr1.length; i--;) {
        if(arr1[i] !== arr2[i])
            return false;
    }

    return true;
}
  




  function rand(num){

    return Math.floor(Math.random()*4+1);
  }

</script>
 
</body></html>
